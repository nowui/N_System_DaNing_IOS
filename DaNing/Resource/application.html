<!DOCTYPE html>
<html>

<head>
    <title>App</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection"content="telephone=no, email=no" />
    <link rel="stylesheet" href="/css/frozen.css">
</head>

<style type="text/css">
  .icon-div {
	position:relative;
	width:50px;
	margin-left:auto;
	margin-right:auto;
  }
  .avatar {
	margin-left:auto !important;
	margin-right:auto !important;
	background-image:none;
  }
  .badge {
	position:absolute;
	right:-3px;
  }
  .icon {
	height:50px;
	line-height:50px;
	margin-left:12.5px;
	color:#ffffff;
  }
</style>

<body>
<section class="margin-top">
	<ul class="ui-list ui-list-pure ui-border-tb">
		<li class="ui-border-t">
			信息门户
		</li>
		<li class="ui-border-t">
			<div class="ui-row-flex ui-whitespace">
                <div class="ui-col ui-col" data-url="/portal/basic.html">
					<div class="ui-avatar avatar" style="background-color:#92cab1;">
						<i class="icon material-icons">&#xe0af;</i>
                    </div>
                    <div class="text-align-center">学校概况</div>
				</div>
                <div class="ui-col ui-col" data-url="/article/index.html">
					<div class="ui-avatar avatar" style="background-color:#ffc652;">
						<i class="icon material-icons">&#xe85d;</i>
                    </div>
                    <div class="text-align-center">校园资讯</div>
				</div>
                <div class="ui-col ui-col" data-url="/portal/view.html">
					<div class="ui-avatar avatar" style="background-color:#75c3d6;">
						<i class="icon material-icons">&#xe410;</i>
                    </div>
                    <div class="text-align-center">校园风光</div>
				</div>
                <div class="ui-col ui-col">

				</div>
            </div>
		</li>
	</ul>
</section>
<section class="margin-top">
	<ul class="ui-list ui-list-pure ui-border-tb">
		<li class="ui-border-t">
			移动办公
		</li>
		<li class="ui-border-t">
			<div class="ui-row-flex ui-whitespace">
                <div class="ui-col ui-col">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#75c3d6;">
							<div id="task_count" class="ui-badge badge display_none">0</div>
							<i class="icon material-icons">&#xe614;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">待办</div>
				</div>
                <div class="ui-col ui-col">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#92cab1;">
							<i class="icon material-icons">&#xe616;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">日程</div>
				</div>
                <div class="ui-col ui-col" data-url="/notice/index.html">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#ffc652;">
							<div id="notice_count" class="ui-badge badge display_none">0</div>
							<i class="icon material-icons">&#xe7f5;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">通知</div>
				</div>
                <div class="ui-col ui-col" data-url="/meeting/index.html">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#a8bd3e;">
							<div id="meeting_count" class="ui-badge badge display_none">0</div>
							<i class="icon material-icons">&#xe8f9;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">会议</div>
				</div>
            </div>
			<div class="ui-row-flex ui-whitespace margin-top">
                <div class="ui-col ui-col">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#ffc652;">
							<i class="icon material-icons">&#xe051;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">课程</div>
				</div>
                <div class="ui-col ui-col" data-url="/leave/index.html">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#a8bd3e;">
							<i class="icon material-icons">&#xe889;</i>
	                    </div>
                    </div>
                    <div class="text-align-center">请假</div>
				</div>
                <div class="ui-col ui-col" data-url="/purchase/index.html">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#75c3d6;">
							<i class="icon material-icons">&#xe8df;</i>
	                    </div>
                	</div>
                    <div class="text-align-center">采购</div>
				</div>
                <div class="ui-col ui-col" data-url="/maintenance/index.html">
                	<div class="icon-div">
						<div class="ui-avatar avatar" style="background-color:#92cab1;">
							<i class="icon material-icons">&#xe8d1;</i>
	                    </div>
                	</div>
                    <div class="text-align-center">维修</div>
				</div>
            </div>
		</li>
	</ul>
</section>
<section class="margin-top margin-bottom">
	<ul class="ui-list ui-list-pure ui-border-tb">
		<li class="ui-border-t">
			移动资源
		</li>
		<li class="ui-border-t">
			<div class="ui-row-flex ui-whitespace">
                <div class="ui-col ui-col">
					<div class="ui-avatar avatar" style="background-color:#92cab1;">
						<i class="icon material-icons">&#xe2c2;</i>
                    </div>
                    <div class="text-align-center">云盘</div>
				</div>
                <div class="ui-col ui-col">
					<div class="ui-avatar avatar" style="background-color:#75c3d6;">
						<i class="icon material-icons">&#xe31e;</i>
                    </div>
                    <div class="text-align-center">eLibrary</div>
				</div>
                <div class="ui-col ui-col">
					<div class="ui-avatar avatar" style="background-color:#ffc652;">
						<i class="icon material-icons">&#xe63a;</i>
                    </div>
                    <div class="text-align-center">微视频</div>
				</div>
                <div class="ui-col ui-col">
					<div class="ui-avatar avatar" style="background-color:#a8bd3e;">
						<i class="icon material-icons">&#xe8b6;</i>
                    </div>
                    <div class="text-align-center">成绩查询</div>
				</div>
            </div>
		</li>
	</ul>
</section>
</body>

</html>
<script src="/js/zepto.min.js"></script>
<script src="/js/zepto.cookie.min.js"></script>
<script src="/js/frozen.js"></script>
<script>
(function () {
	var userId = $.fn.cookie(CookieUserId);
	var isLanch = false;

	$("[data-url]").on("click",function(e) {
      	window.location.href = $(this).attr("data-url");
    });

	load = function() {
		$.ajax({
		  	type: "POST",
		  	url: "/count",
		    contentType: "application/json;charset=utf-8",
		  	data: JSON.stringify({
		  		userId: userId
		  	}),
		  	dataType: "json",
		  	success: function(data, status, xhr) {
				if(data.result) {
					var task_count = data.data.taskCount;
					var notice_count = data.data.noticeCount;
					var meeting_count = data.data.meetingCount;

					if(task_count > 0) {
						$("#task_count").removeClass("display_none");

						$("#task_count").html(task_count);
					} else {
						$("#task_count").addClass("display_none");
					}

					if(notice_count > 0) {
						$("#notice_count").removeClass("display_none");

						$("#notice_count").html(notice_count);
					} else {
						$("#notice_count").addClass("display_none");
					}

					if(meeting_count > 0) {
						$("#meeting_count").removeClass("display_none");

						$("#meeting_count").html(meeting_count);
					} else {
						$("#meeting_count").addClass("display_none");
					}
				}
		  	},
		  	error: function(xhr, errorType, error) {

		  	},
		  	complete: function(xhr, status) {
				isLanch = true;
		  	}
		})
	}

	initjsBridge = function() {
		jsBridge.send(ActionGetSetting, {

		}, function(response) {
			userId = response.data.appUserId;

			load();
		});

		jsBridge.registerEvent(ActionGetAppear, function(response, responseCallback) {
			if(isLanch) {
				load();
			}
	    });

		jsBridge.registerEvent(ActionGetPush, function(response, responseCallback) {
			load();
	    });
	}

	if(isWeb) {
		load();
	}
})();
</script>